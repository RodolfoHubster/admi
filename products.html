<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Fitoscents Admin</title>
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
        
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
        <link rel="stylesheet" href="assets/css/main.css">
    </head>
    <body>

        <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4 shadow">
            <div class="container">
                <a class="navbar-brand fw-bold" href="index.html">üëë Fitoscents</a>
                
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
        
                <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                    <div class="navbar-nav gap-2">
                        <a href="index.html" class="nav-link">Inicio</a>
                        <a href="products.html" class="nav-link active">üì¶ Inventario</a>
                        <a href="ventas.html" class="nav-link">üí∞ Ventas</a>
                        <a href="clientes.html" class="nav-link">üë• Clientes</a>
                    </div>
                </div>
            </div>
        </nav>
        
        <div class="container mb-5">
            
            <div class="row align-items-center mb-4 g-3">
                <div class="col-md-4">
                    <h2 class="fw-bold m-0 text-gold">üì¶ Inventario</h2>
                    <p class="text-muted small m-0">Gesti√≥n de stock y precios</p>
                </div>
        
                <div class="col-md-4">
                    <div class="input-group shadow-sm">
                        <span class="input-group-text bg-dark border-end-0"><i class="bi bi-search"></i></span>
                        <input type="text" id="buscador" class="form-control border-start-0 ps-0" 
                               placeholder="Buscar perfume, marca o SKU..." onkeyup="filtrarTabla()">
                    </div>
                </div>
        
                <div class="col-md-4 text-md-end d-flex gap-2 justify-content-md-end">
                    <div class="btn-group shadow-sm">
                        <button class="btn btn-outline-secondary" onclick="descargarRespaldo()" title="Bajar Respaldo">
                            ‚¨áÔ∏è
                        </button>
                        <button class="btn btn-outline-secondary" onclick="document.getElementById('fileInput').click()" title="Subir Respaldo">
                            ‚¨ÜÔ∏è
                        </button>
                    </div>
                    <input type="file" id="fileInput" style="display: none;" onchange="cargarRespaldo(this)">
        
                    <button class="btn btn-success fw-bold shadow-sm" 
                            data-bs-toggle="modal" 
                            data-bs-target="#modalNuevoPerfume" 
                            onclick="restaurarModalNuevo()">
                        <i class="bi bi-plus-lg me-1"></i> Nuevo Perfume
                    </button>
                </div>
            </div>
    
            <div class="card shadow mb-3 border-0">
                <div class="card-body py-2">
                    <div class="row g-2 align-items-center">
                        <div class="col-auto fw-bold text-muted small">
                            <i class="bi bi-funnel-fill"></i> FILTRAR POR:
                        </div>
                        <div class="col-md-3">
                            <select class="form-select form-select-sm border-0 bg-dark fw-bold" id="filtroPropiedad" onchange="cargarInventario()">
                                <option value="todos">üè† Propiedad: TODOS</option>
                                <option value="mio">üîµ Solo M√≠os</option>
                                <option value="socio">üü° Solo Socio</option>
                                <option value="mitad">üåó Mitad y Mitad</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select form-select-sm border-0 bg-dark fw-bold" id="filtroDestino" onchange="cargarInventario()">
                                <option value="todos">üì¶ Destino: TODOS</option>
                                <option value="stock">‚úÖ En Stock (Libre)</option>
                                <option value="pedido">üë§ Pedidos (Apartados)</option>
                                <option value="en_camino">üöö En Camino (Por llegar)</option>
                            </select>
                        </div>
                        <div class="col text-end small text-muted">
                            <span id="contador-visible">0</span> perfumes visibles
                        </div>
                    </div>
                </div>
            </div>
        
            <div class="card shadow">
                <div class="card-body p-0">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-dark text-white">
                            <tr>
                                <th style="width: 10%">SKU</th>
                                
                                <th style="width: 20%; cursor: pointer;" onclick="cambiarOrden('nombre')">
                                    Producto <i class="bi bi-arrow-down-up small opacity-50"></i>
                                </th>
                                
                                <th style="width: 10%">Propiedad</th>
                                <th style="width: 10%">Destino</th>
                                <th style="width: 12%">Ubicaci√≥n</th>
                                
                                <th style="width: 8%; cursor: pointer;" onclick="cambiarOrden('precio')">
                                    Precio <i class="bi bi-arrow-down-up small opacity-50"></i>
                                </th>
                        
                                <th style="width: 8%; cursor: pointer;" onclick="cambiarOrden('ganancia')">
                                    Ganancia <i class="bi bi-arrow-down-up small opacity-50"></i>
                                </th>
                                
                                <th style="width: 7%">Stock</th>
                                
                                <th style="width: 15%">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-table-body">
                            </tbody>
                    </table>
                    
                    <div id="empty-msg" class="text-center text-muted p-5" style="display:none;">
                        üëª No hay perfumes que coincidan con estos filtros.
                    </div>
                </div>
            </div>
</div>

<div class="modal fade" id="modalNuevoPerfume" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Registrar Perfume</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="form-nuevo-perfume">
                    <div class="mb-3">
                        <label class="form-label">Nombre del Perfume</label>
                        <input type="text" class="form-control" id="inputNombre" required placeholder="Ej: Jean Paul Gaultier Le Male">
                        <label class="form-label">Foto (URL de Internet)</label>
                    <input type="url" class="form-control" id="inputImagen" placeholder="Pega el link de la imagen aqu√≠...">
                    <div class="form-text">Busca la imagen en Google, clic derecho -> "Copiar direcci√≥n de imagen".</div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Marca/Casa</label>
                            <input type="text" class="form-control" id="inputMarca" placeholder="Ej: JPG">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">SKU / C√≥digo</label>
                            <input type="text" class="form-control" id="inputSku" placeholder="Generar auto si vac√≠o">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Costo (Lo que pagaste)</label>
                            <input type="number" class="form-control" id="inputCosto" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Precio Venta</label>
                            <input type="number" class="form-control" id="inputPrecio" required>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Destino del Perfume</label>
                            <select class="form-select" id="inputDestino">
                                <option value="stock">üè† Stock General (Venta Libre)</option>
                                <option value="pedido">üë§ Pedido / Encargo</option>
                            </select>

                        <div class="mb-3 p-3 bg-dark border rounded border-warning">
                            <label class="form-label fw-bold"><i class="bi bi-geo-alt-fill"></i> Estatus de Ubicaci√≥n</label>
                            <select class="form-select fw-bold" id="inputUbicacion">
                                <option value="en_inventario" selected>‚úÖ En Inventario (Lo tengo f√≠sico)</option>
                                <option value="en_camino">üöö En Camino (Paqueter√≠a/Por llegar)</option>
                            </select>
                                <small class="text-muted">Si pones "En Camino", aparecer√° con una alerta visual.</small>
                        </div>        

                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Nombre Cliente (Opcional)</label>
                            <input type="text" class="form-control" id="inputCliente" placeholder="Solo si es pedido">
                        </div>
                    </div>
                    
                    <div class="mb-3 p-3 bg-dark border rounded">
                        <label class="form-label fw-bold">¬øQui√©n invirti√≥?</label>
                        <select class="form-select" id="inputInversion" onchange="togglePersonalizado()">
                            <option value="mio">100% M√≠o (Rodolfo)</option>
                            <option value="socio">100% Socio</option>
                            <option value="mitad">50% / 50% (Ambos)</option>
                            <option value="personalizado">Otro % (Personalizado)</option>
                        </select>
                        
                        <div id="divPersonalizado" class="mt-2" style="display: none;">
                            <label class="form-label text-primary small">¬øQu√© porcentaje es del SOCIO?</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="inputPorcentajeSocio" placeholder="Ej: 30">
                                <span class="input-group-text">%</span>
                            </div>
                            <small class="text-muted">El resto ser√° tuyo autom√°ticamente.</small>
                        </div>
                    </div>
                    
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="checkDecants">
                        <label class="form-check-label" for="checkDecants">
                            ¬øHabilitar para Decants? (Futuro)
                        </label>
                    </div>
                    <small class="text-muted d-block mb-3">Si no se marca, se tratar√° como botella sellada √∫nica.</small>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="guardarProducto()">Guardar Perfume</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalVenta" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">üí∞ Cerrar Venta</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <div class="modal-body">
                <div class="alert alert-dark border text-center mb-3">
                    Vendiendo: <strong id="venta-nombre-producto" class="text-success">---</strong>
                </div>
                
                <div class="row mb-3">
                    <div class="col-6">
                        <label class="form-label small text-muted">Precio Lista</label>
                        <input type="text" class="form-control" id="venta-precio-lista" disabled>
                    </div>
                    <div class="col-6">
                        <label class="form-label fw-bold text-success">Precio Final</label>
                        <input type="number" class="form-control form-control-lg" id="venta-precio-final" placeholder="0.00">

                    <div class="mb-3">
                        <label class="form-label text-danger small fw-bold">üìâ Gastos Extra (Env√≠o, Caja, Comisi√≥n)</label>
                        <div class="input-group input-group-sm">
                        <span class="input-group-text bg-dark text-danger">$</span>
                            <input type="number" class="form-control text-danger fw-bold" id="venta-gastos" value="0" placeholder="0">
                        </div>
                            <div class="form-text small">Esto se restar√° de tu ganancia, no se le cobra al cliente.</div>
                    </div>
                        
                        <hr>    
                    </div>
                </div>

                <hr>

                <div class="form-check form-switch mb-3 bg-dark p-2 rounded">
                    <input class="form-check-input" type="checkbox" id="checkCredito" onchange="toggleCredito()">
                    <label class="form-check-label fw-bold ms-2" for="checkCredito">‚ö†Ô∏è ¬øEs Venta a Cr√©dito (Fiado)?</label>
                </div>

                <div id="bloque-credito" style="display: none;" class=" p-3 rounded border border-warning">
                    <div class="mb-3">
                        <label class="form-label text-primary fw-bold">Nombre del Cliente (Obligatorio)</label>
                        <input type="text" class="form-control" id="venta-cliente" placeholder="Ej: Juan P√©rez">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">¬øCu√°nto deja de anticipo?</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="venta-anticipo" value="0">
                        </div>
                        <div class="form-text text-danger fw-bold mt-1" id="texto-restante">Resta por cobrar: $0.00</div>
                    </div>
                </div>

                <input type="hidden" id="venta-index-producto">
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-success fw-bold" onclick="confirmarVentaFinal()">‚úÖ Confirmar Venta</button>
            </div>
        </div>
    </div>
</div>

<div id="barra-carrito" class="fixed-bottom bg-dark text-white p-3 shadow-lg" style="display: none; border-top: 4px solid #3498db; z-index: 1050;">
    <div class="container d-flex justify-content-between align-items-center">
        <div>
            <span class="badge bg-primary fs-6 me-2" id="cart-count">0</span>
            <span class="fw-bold fs-5 align-middle">Productos en caja</span>
        </div>
        <div class="d-flex align-items-center gap-3">
            <div class="text-end lh-1">
                <div class="small text-white-50">Total a Cobrar</div>
                <div class="fw-bold fs-4 text-warning" id="cart-total">$0.00</div>
            </div>
            <button class="btn btn-dark fw-bold text-dark px-4" onclick="abrirModalCarrito()">
                üõí Ver / Cobrar
            </button>
        </div>
    </div>
</div>

<div class="modal fade" id="modalCarrito" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title fw-bold">üõí Carrito de Compras</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <ul class="list-group mb-4" id="lista-carrito">
                    </ul>
                
                <div class="card bg-dark border-0 p-3">
                    <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="checkCreditoCarrito">
                        <label class="form-check-label fw-bold" for="checkCreditoCarrito">‚ö†Ô∏è ¬øEs Venta a Cr√©dito (Fiado)?</label>
                    </div>
                    <div class="input-group">
                        <span class="input-group-text">üë§ Cliente</span>
                        <input type="text" class="form-control" id="inputClienteCarrito" placeholder="Nombre del cliente (Opcional si es contado)">
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-outline-danger" onclick="vaciarCarrito()">üóëÔ∏è Vaciar Todo</button>
                <div>
                    <span class="fs-4 fw-bold me-3" id="modal-cart-total">$0.00</span>
                    <button type="button" class="btn btn-success fw-bold btn-lg" onclick="procesarVentaMasiva()">‚úÖ Cobrar Todo</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalTicket" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-transparent border-0"> <div class="modal-body p-0">
                <div class="ticket-container" id="ticket-content">
                    
                    <div class="ticket-header">
                        <h3>üëë Fitoscents</h3>
                        <small>Ticket de Venta</small><br>
                        <small id="ticket-fecha">DD/MM/AAAA HH:MM</small>
                    </div>

                    <div class="mb-3 text-start">
                        <small>Cliente: <strong id="ticket-cliente">Mostrador</strong></small><br>
                        <small>Estado: <span id="ticket-estado">PAGADO</span></small>
                    </div>

                    <div id="ticket-items">
                        </div>

                    <div class="ticket-total">
                        <span>TOTAL:</span>
                        <span id="ticket-total-monto">$0.00</span>
                    </div>

                    <div id="ticket-credito-info" style="display:none; border-top: 1px dotted #000; margin-top:5px; padding-top:5px;">
                        <div class="d-flex justify-content-between small">
                            <span>Acuenta:</span> <span id="ticket-acuenta">$0.00</span>
                        </div>
                        <div class="d-flex justify-content-between small text-danger fw-bold">
                            <span>Resta:</span> <span id="ticket-resta">$0.00</span>
                        </div>
                    </div>

                    <div class="ticket-footer">
                        <p>¬°Gracias por tu compra!<br>********</p>
                        <button class="btn btn-dark btn-sm w-100 mt-2 no-print" onclick="cerrarTicket()">Cerrar y Seguir</button>
                    </div>

                </div>
            </div>

        </div>
    </div>
</div>

<div id="image-preview-popup"><img src="" alt="Preview"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="assets/js/config.js"></script>    <script src="assets/js/utils.js"></script>     <script src="assets/js/inventory.js"></script> <script src="assets/js/sales.js"></script>     <script src="assets/js/cart.js"></script>      <script src="assets/js/backup.js"></script>    <script src="assets/js/main.js"></script>      ```
</body>
</html>